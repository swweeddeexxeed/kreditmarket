name: üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–∫–∏ VK –û–±–ª–∞–∫–∞

on:
  workflow_dispatch:

jobs:
  check-link:
    runs-on: ubuntu-latest
    
    steps:
    - name: üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å—Å—ã–ª–æ–∫
      run: |
        echo "=== –¢–ï–°–¢–ò–†–£–Æ –°–°–´–õ–ö–ò VK –û–ë–õ–ê–ö–û ==="
        echo "–í–∞—à–∞ —Å—Å—ã–ª–∫–∞: https://cloud.mail.ru/public/4Nef/r6uipVAxF"
        echo ""
        
        # –í–∞—Ä–∏–∞–Ω—Ç—ã —Å—Å—ã–ª–æ–∫ –¥–ª—è —Ç–µ—Å—Ç–∞
        declare -A urls
        urls[1]="https://cloud.mail.ru/public/4Nef/r6uipVAxF"
        urls[2]="https://cloud.mail.ru/public/4Nef/r6uipVAxF/download"
        urls[3]="https://cloud.mail.ru/public/4Nef/r6uipVAxF?download=1"
        urls[4]="https://cloud.mail.ru/public/4Nef/r6uipVAxF?dl=1"
        
        for i in {1..4}; do
          echo "--- –¢–µ—Å—Ç $i: ${urls[$i]} ---"
          
          # –°–∫–∞—á–∏–≤–∞–µ–º —Å —Ç–∞–π–º–∞—É—Ç–æ–º
          timeout 10 curl -L -s -o "test_$i" -w "HTTP –∫–æ–¥: %{http_code}\n–†–∞–∑–º–µ—Ä: %{size_download} –±–∞–π—Ç\n" "${urls[$i]}" || echo "–¢–∞–π–º–∞—É—Ç!"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–∫–∞—á–∞–ª–æ—Å—å
          if [ -f "test_$i" ]; then
            echo "–¢–∏–ø —Ñ–∞–π–ª–∞: $(file -b "test_$i")"
            echo "–ü–µ—Ä–≤—ã–µ 50 –±–∞–π—Ç (hex):"
            xxd -l 50 "test_$i"
            echo ""
          else
            echo "–§–∞–π–ª –Ω–µ —Å–∫–∞—á–∞–ª—Å—è"
            echo ""
          fi
        done
        
        echo "=== –†–ï–ó–£–õ–¨–¢–ê–¢ ==="
        echo "–ï—Å–ª–∏ –≤ hex –≤–∏–¥–Ω–æ '504b0304' –≤ –Ω–∞—á–∞–ª–µ ‚Äî —ç—Ç–æ Excel —Ñ–∞–π–ª"
        echo "–ï—Å–ª–∏ –≤–∏–¥–Ω–æ '3c21444f4354595045' (<!DOCTYPE) ‚Äî —ç—Ç–æ HTML"
        
    - name: üì§ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      uses: actions/upload-artifact@v3
      with:
        name: link-test-results
        path: test_*
